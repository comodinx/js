/**
 * CX TimerTask - Version 1.0
 * 
 * License:
 * 	MIT license. 
 * 
 * Copyright:
 * 	Copyright (c) 2013 - 2014 [Nicolas Molina - Comodinx] (http://opensource.org/licenses/mit-license.php)
 */
!function(f){function e(h){return h.charAt(0).toUpperCase()+h.substring(1).toLowerCase();}function g(j,i){var h;for(h in i){j[h]=i[h];}return j;}function c(k){var j,h;for(j=1,h=arguments.length;j<h;j++){g(k,arguments[j]);}return k;}var d=f.Class.create("TimerPool",(function(){function m(y,z){for(var x=0,w=y.length;x<w;){if(z.call(y[x],x,y[x++])===false){break;}}}function p(x,y){var w,z;m(y,function(A,B){if(typeof B==="function"){z=B;}else{z=B.callback;w=B.options;}x.add(z,w);});}var n=function(w,x){if(Object.prototype.toString(w)==="[object Array]"){x=w;w={};}this.options=c({},l,(w||{}));this._timers=[];this._timerIdCount=0;this.state=b.states.UNSTARTED;p(this,(x||this._timers));},l={interval:1000,onChangeState:false,stopOnError:true,autoStart:false};function v(z,w){var x=c({},this.options,(w||{})),y=new b(z,x);this._timers.push(y);if(!y.timer_id){y.timer_id=("TimerTask-"+(++this._timerIdCount));}if(this.state==b.states.RUNNING){y.start();}return y;}function k(w){if(isNaN(w)){w=this.indexOf(w);}if(w<0||w>this._timers.length-1){return;}var x=this._timers.splice(w,1);x[0].stop();delete x[0];}function o(){this.stop();var x,w;for(x=0;x<this.length();){this.remove(x);}}function r(y){var x,w;for(x=0,w=this.length();x<w;x++){if(this._timers[x].timer_id==y){return x;}}return -1;}function j(){return this._timers.length;}function i(w){this.state=b.states.RUNNING;m(this._timers,function(x,y){y.start(w);});return this;}function q(w){w=(w||b.states.STOPPED);this.state=w;m(this._timers,function(x,y){y.stop(w);});return this;}function t(w){this.stop();this.start(w);return this;}function u(){this.stop(b.states.CANCELED);return this;}function h(){this.stop(b.states.COMPLETE);return this;}function s(w){m(this._timers,function(x,y){y.setTime(w);});return this;}return{constructor:n,add:v,remove:k,clean:o,indexOf:r,length:j,start:i,stop:q,sleep:t,cancel:u,complete:h,setTime:s};})()),b=f.Class.create("TimerTask",(function(){var h=function(s,r){r=(r||{});this.callback=s;this.options=c({},l,r);this._timer=null;this._timerout=null;this.state=h.states.UNSTARTED;this.stateInfo=null;if(this.options.history){this.historyState=[];}if(this.options.autoStart){this.start();}},l={interval:1000,onChangeState:false,stopOnError:true,autoStart:false,history:false};h.states={UNSTARTED:"unstarted",WAITING:"waiting",RUNNING:"running",STOPPED:"stopped",CANCELED:"canceled",COMPLETE:"complete",ERROR:"error"};function k(r){n(r,h.states.RUNNING);r._timer=setInterval(function(){try{r.callback(r);}catch(s){n(r,h.states.ERROR);r.stateInfo=s;if(r.options.stopOnError){r.stop(h.states.ERROR);}else{n(r,h.states.RUNNING);}}},r.options.interval);}function n(u,s){if(u.state!=s){var r=u.state,t=u.options[("on"+e(s))];u.state=s;if(u.options.onChangeState){u.options.onChangeState(u,r,s);}if(t){t(u,r);}if(u.options.history){u.historyState.push({date:new Date(),state:r});}}}function j(s){if(this.state!=h.states.RUNNING&&this.state!=h.states.WAITING){var r=this;n(r,h.states.WAITING);r._timerout=setTimeout(function(){k(r);},(s||0));}return this;}function m(r){if(this.state!=h.states.STOPPED&&this.state!=h.states.CANCELED&&this.state!=h.states.COMPLETE&&this.state!=h.states.ERROR){n(this,(r||h.states.STOPPED));if(this._timerout!=null){clearTimeout(this._timerout);this._timerout=null;}if(this._timer!=null){clearInterval(this._timer);this._timer=null;}}return this;}function p(r){if(this.state==h.states.RUNNING||this.state==h.states.WAITING){this.stop();this.start(r);}return this;}function q(){if(this.state==h.states.RUNNING||this.state==h.states.WAITING){this.stop(h.states.CANCELED);}return this;}function i(){if(this.state==h.states.RUNNING||this.state==h.states.WAITING){this.stop(h.states.COMPLETE);}return this;}function o(s){var r=this.state;if(r==h.states.RUNNING||r==h.states.WAITING){this.stop();}this.options.interval=s;if(r==h.states.RUNNING||r==h.states.WAITING){this.start();}return this;}return{constructor:h,start:j,stop:m,sleep:p,cancel:q,complete:i,setTime:o};})()),a=f.Class.create("TimerExec",(function(){var h=function(l,k){this.callback=l;this.time=(k||1000);this.executing=false;this.start();};function j(){if(this.timer){return;}var k=this;k.timer=setInterval(function(){if(!k.executing){try{k.executing=true;k.callback(k);k.executing=false;}catch(l){k.executing=false;throw l;}}},k.time);}function i(){if(!this.timer){return;}clearInterval(this.timer);this.timer=null;}return{constructor:h,start:j,stop:i};})());f.TimerPool=d;f.TimerTask=b;f.TimerExec=a;}(window);